flowchart TD
    U[User via Telegram] -->|Messages| TG[Telegram Bot]

    subgraph BotCore[Bot Core Logic]
        TG --> AUTH[Auth and user state handler]
        TG --> SUBCHECK[Subscription and trial checker]
        TG --> ROUTER[Message router]
        TG --> ERROR[Error handler]
        TG --> LOG[Logging module]
    end

    subgraph Business[Business Logic Services]
        SUBCHECK --> SUBSYS[Subscription Service]
        ROUTER --> AI[AI service]
        SUBSYS --> PAY[Payment Handler]
        SUBSYS --> TRIAL[Free Trial Manager]
    end

    subgraph DatabaseLayer[Database Layer]
        DB[(PostgreSQL Database)]
    end

    AUTH --> DB
    SUBSYS --> DB
    TRIAL --> DB
    LOG --> DB

    subgraph Infra[Infrastructure]
        VPS[VPS Server] --> NGINX[NGINX Reverse proxy and SSL]
        NGINX --> APP[Containerized app in docker - optional]
        APP --> TG
        APP --> DB
    end

    PAY --> TG
